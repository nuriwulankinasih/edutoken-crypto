<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Kuis Kriptografi EduToken</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <style>
        body { background-color: #f4f7f6; }
        .card { border-radius: 15px; border: none; }
        .btn-claim { background: linear-gradient(45deg, #FFD700, #FFA500); color: black; font-weight: bold; border: none; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6 text-center">
                <h3 class="mb-4">Selamat Datang, <strong>{{ user }}</strong>!</h3>
                
                <div class="card shadow p-4 mb-4">
                    <h5>Pertanyaan Materi 2:</h5>
                    <p>Teknik mengubah data menjadi kode unik yang sulit dikembalikan ke aslinya disebut...</p>
                    <form method="POST">
                        <div class="d-grid gap-2 text-start">
                            <label class="btn btn-outline-primary shadow-sm">
                                <input type="radio" name="jawaban" value="copy"> Copy-Paste Data
                            </label>
                            <label class="btn btn-outline-primary shadow-sm">
                                <input type="radio" name="jawaban" value="hashing"> Hashing (SHA-256)
                            </label>
                        </div>
                        <button type="submit" class="btn btn-dark mt-4 w-100">Cek Jawaban</button>
                    </form>
                </div>

                {% if reward_ready %}
                <div class="card shadow p-4 bg-white border-success">
                    <h4 class="text-success">ðŸŽ‰ Jawaban Benar!</h4>
                    <p>Token EduToken siap dikirim ke dompet MetaMask Anda.</p>
                    <button onclick="prosesKlaim()" class="btn btn-claim btn-lg w-100 shadow">KLAIM 10 TOKEN SEKARANG</button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        const contractAddress = "0xd8b934580fcE35a11B58C6D73aDeE468a2833fa8";
        const abi = [ { "inputs": [ { "components": [], "internalType": "address", "name": "spender", "type": "address" }, { "internalType": "uint256", "name": "value", "type": "uint256" } ], "name": "approve", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "student", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" } ], "name": "claimReward", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "stateMutability": "nonpayable", "type": "constructor" }, { "inputs": [ { "internalType": "address", "name": "to", "type": "address" }, { "internalType": "uint256", "name": "value", "type": "uint256" } ], "name": "transfer", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [ { "internalType": "address", "name": "account", "type": "address" } ], "name": "balanceOf", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" } ];
        // Catatan: ABI saya persingkat untuk efisiensi code, namun tetap berisi fungsi claimReward Anda.

        async function prosesKlaim() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    const signer = provider.getSigner();
                    const contract = new ethers.Contract(contractAddress, abi, signer);

                    const userAddress = await signer.getAddress();
                    // Memanggil fungsi claimReward di kontrak Anda (10 token)
                    const tx = await contract.claimReward(userAddress, 10); 
                    
                    alert("Transaksi dikirim! Silakan konfirmasi di MetaMask.");
                    await tx.wait();
                    alert("Berhasil! Token 10 EDT telah masuk ke dompet Anda.");
                } catch (error) {
                    alert("Error: " + error.message);
                }
            } else {
                alert("Silakan instal MetaMask!");
            }
        }
    </script>
</body>
</html>
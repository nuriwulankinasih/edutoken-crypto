<!DOCTYPE html>
<html>
<head>
    <title>Profil EduToken</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { background: #0d1117; color: white; padding: 50px; font-family: 'Segoe UI', sans-serif; }
        .profile-card { background: #161b22; border: 1px solid #8a2be2; padding: 40px; border-radius: 20px; text-align: center; }
        .token-balance { font-size: 3rem; color: #00f2ff; text-shadow: 0 0 10px #00f2ff; }
        .history-section { margin-top: 40px; background: #161b22; padding: 20px; border-radius: 15px; }
    </style>
</head>
<body>
    <div class="container" style="max-width: 700px;">
        <div class="profile-card">
            <h3>ðŸ‘¤ {{ user }}</h3>
            <div class="my-4">
                <small class="text-muted">TOTAL SALDO TOKEN</small>
                <div class="token-balance" id="bal">0</div>
                <div id="sym" class="text-info">...</div>
            </div>
            <a href="/dashboard" class="btn btn-outline-light">Kembali ke Dashboard</a>
        </div>

        <div class="history-section">
            <h5 class="mb-3">ðŸ•’ Riwayat Aktivitas Belajar</h5>
            <table class="table table-dark table-hover">
                <thead><tr><th>Materi</th><th>Reward</th><th>TX Hash</th></tr></thead>
                <tbody>
                    {% for h in history %}
                    <tr>
                        <td>{{ h.activity_name }}</td>
                        <td class="text-info">+{{ h.amount }}</td>
                        <td><small>{{ h.tx_hash[:10] }}...</small></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadBal() {
            if (window.ethereum) {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const contract = new ethers.Contract("0x00f89381E559375738c48b5A0E7eB7F5BfD3146b", ["function balanceOf(address) view returns (uint256)", "function symbol() view returns (string)"], provider);
                const accounts = await provider.send("eth_requestAccounts", []);
                const balance = await contract.balanceOf(accounts[0]);
                document.getElementById('bal').innerText = ethers.utils.formatUnits(balance, 18);
                document.getElementById('sym').innerText = await contract.symbol();
            }
        }
        window.onload = loadBal;
    </script>
</body>
</html>